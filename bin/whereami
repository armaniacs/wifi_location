#!/usr/bin/env ruby
require File.expand_path '../lib/wifi_location', File.dirname(__FILE__)
require 'rubygems'
require 'args_parser'
require 'json'

parser = ArgsParser.parse ARGV do
  arg :help, 'show help', :alias => :h
  arg :towers, 'dump WiFi towers'
  arg :dump, 'dump ALL'
  arg :map, 'open Google Map'
  arg :version, 'show version', :alias => :v
end

if parser.has_option? :help
  puts parser.help
  puts "--"
  puts "wifi_location v#{WiFiLocation::VERSION} - https://github.com/shokai/wifi_location"
  exit
end

if parser.has_option? :version
  puts "wifi_location v#{WiFiLocation::VERSION} - https://github.com/shokai/wifi_location"
  exit
end

towers = WiFiLocation.wifi_towers

if parser.has_option? :towers
  puts towers.to_json
  exit
end

location = WiFiLocation.location towers

if parser.has_option? :dump
  h = {:towers => towers, :location => location}
  puts h.to_json
  exit
end

if parser.has_option? :map
  puts url = "https://maps.google.com/?ll=#{location['latitude']},#{location['longitude']}"
  exit
end

puts "lat=#{location['latitude']},lon=#{location['longitude']}"
